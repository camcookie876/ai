<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Camcookie AI</title>
    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: #050816;
        color: #f9fafb;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 24px;
      }
      h1 {
        margin-bottom: 16px;
      }
      #input {
        width: 100%;
        max-width: 600px;
        height: 120px;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #4b5563;
        background: #020617;
        color: #f9fafb;
        resize: vertical;
      }
      #run {
        margin-top: 10px;
        padding: 8px 16px;
        border-radius: 999px;
        border: none;
        background: #22c55e;
        color: #022c22;
        font-weight: 600;
        cursor: pointer;
      }
      #run:disabled {
        opacity: 0.6;
        cursor: default;
      }
      #output {
        margin-top: 18px;
        width: 100%;
        max-width: 600px;
        min-height: 120px;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #4b5563;
        background: #020617;
        white-space: pre-wrap;
      }
      #status {
        margin-top: 8px;
        font-size: 0.85rem;
        color: #9ca3af;
      }
    </style>
  </head>
  <body>
    <h1>Camcookie AI</h1>

    <textarea id="input" placeholder="Ask Camcookie AI anything..."></textarea>
    <button id="run">Ask</button>
    <div id="status"></div>

    <h3>Answer</h3>
    <pre id="output"></pre>

    <script>
      const FUNCTION_URL =
        "https://mzzpwrtcusgbtwtnjfhv.supabase.co/functions/v1/camcookie-ai";

      const inputEl = document.getElementById("input");
      const runBtn = document.getElementById("run");
      const outputEl = document.getElementById("output");
      const statusEl = document.getElementById("status");

      async function runAI() {
        const message = inputEl.value.trim();
        if (!message) {
          outputEl.textContent = "Type something first.";
          return;
        }

        runBtn.disabled = true;
        statusEl.textContent = "Talking to Camcookie AIâ€¦";
        outputEl.textContent = "";

        try {
          const res = await fetch(FUNCTION_URL, {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({ message })
          });

          if (!res.ok) {
            const text = await res.text();
            outputEl.textContent = "Error from function:\n" + text;
            statusEl.textContent = "Error.";
            runBtn.disabled = false;
            return;
          }

          const data = await res.json();
          const reply = data.choices?.[0]?.message?.content || "(No reply)";
          outputEl.textContent = reply;
          statusEl.textContent = "Done.";
        } catch (err) {
          outputEl.textContent = "Network or JS error:\n" + err;
          statusEl.textContent = "Error.";
        } finally {
          runBtn.disabled = false;
        }
      }

      runBtn.addEventListener("click", runAI);
      inputEl.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && (e.metaKey || e.ctrlKey)) {
          runAI();
        }
      });
    </script>
  </body>
</html>