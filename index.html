<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Camcookie AI Test</title>
  </head>
  <body>
    <h1>Camcookie AI — Basic Test</h1>

    <p id="status">Loading model…</p>

    <textarea id="input" rows="4" cols="50" placeholder="Type something..."></textarea>
    <br />
    <button id="run">Generate</button>

    <h3>Output:</h3>
    <pre id="output"></pre>

    <!-- Correct browser build -->
    <script src="https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2/dist/transformers.min.js"></script>

    <script>
      let pipe;

      async function loadModel() {
        const status = document.getElementById("status");
        status.textContent = "Loading model… please wait";

        try {
          pipe = await window.transformers.pipeline(
            "text-generation",
            "Xenova/distilgpt2"
          );
          status.textContent = "Model loaded!";
        } catch (err) {
          status.textContent = "Error loading model: " + err;
          console.error(err);
        }
      }

      async function runGeneration() {
        const input = document.getElementById("input").value;
        const output = document.getElementById("output");

        if (!pipe) {
          output.textContent = "Model not ready yet.";
          return;
        }

        output.textContent = "Generating…";

        try {
          const result = await pipe(input, {
            max_new_tokens: 60,
            temperature: 0.9,
          });

          output.textContent = result[0].generated_text;
        } catch (err) {
          output.textContent = "Error: " + err;
          console.error(err);
        }
      }

      document.getElementById("run").onclick = runGeneration;

      loadModel();
    </script>
  </body>
</html>